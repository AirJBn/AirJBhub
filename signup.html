<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Access Request - AirJB Hub</title>
    <meta name="description" content="Request administrative access to the AirJB management system.">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@100;200;300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico">
</head>
<body class="signup-page">
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <h1>AirJB</h1>
                <span class="tagline">AtyoursTruly</span>
            </div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Back to Login</a>
            </div>
        </div>
    </nav>

    <!-- Signup Section -->
    <section class="admin-login">
        <div class="login-container">
            <div class="login-card">
                <div class="login-header">
                    <h1>AirJB Hub</h1>
                    <p>Request Admin Access</p>
                </div>
                <form class="login-form signup-form" id="signup-form">
                    <div class="input-group">
                        <label for="signup-email">Email Address</label>
                        <input type="email" id="signup-email" required placeholder="your.email@company.com">
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label for="signup-password">Password</label>
                            <input type="password" id="signup-password" required placeholder="Minimum 6 characters" minlength="6">
                        </div>
                        <div class="input-group">
                            <label for="signup-confirm">Confirm Password</label>
                            <input type="password" id="signup-confirm" required placeholder="Confirm your password">
                        </div>
                    </div>
                    <div class="input-group">
                        <label for="signup-reason">Reason for Access</label>
                        <textarea id="signup-reason" placeholder="Brief explanation of why you need admin access..." rows="2" style="width: 100%; background: #1a1a1a; border: 1px solid #404040; border-radius: 4px; color: #ffffff; padding: 12px; font-family: 'Josefin Sans', sans-serif; resize: vertical;"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">Submit Request</button>
                </form>
                <div class="login-footer">
                    <p><em>At Yours Truly</em> â€¢ Partner Access Request</p>
                </div>
            </div>
        </div>
    </section>

    <!-- Firebase CDN scripts -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDtdxcSoVmLj-gGRkj0E5zXrTRHPZK3Fi4",
            authDomain: "airjb-f1883.firebaseapp.com",
            databaseURL: "https://airjb-f1883-default-rtdb.firebaseio.com/",
            projectId: "airjb-f1883",
            storageBucket: "airjb-f1883.appspot.com",
            messagingSenderId: "485974977846",
            appId: "1:485974977846:web:f1883airjb001"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Handle form submission
        document.getElementById('signup-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('signup-email').value.trim();
            const password = document.getElementById('signup-password').value;
            const confirmPassword = document.getElementById('signup-confirm').value;
            const reason = document.getElementById('signup-reason').value.trim();
            
            // Validate form
            if (!email || !password || !confirmPassword) {
                showError('Please fill in all required fields.');
                return;
            }
            
            if (password !== confirmPassword) {
                showError('Passwords do not match.');
                return;
            }
            
            if (password.length < 6) {
                showError('Password must be at least 6 characters long.');
                return;
            }

            // Check if signup is open
            try {
                const response = await fetch('https://raw.githubusercontent.com/AirJBn/AirJBhub/main/Yourtruly.txt');
                const text = await response.text();
                
                if (text.trim().toLowerCase() !== 'open') {
                    showError('Admin signup is currently closed. Please try again later.');
                    return;
                }
            } catch (error) {
                console.log('Could not verify signup status, proceeding anyway');
            }

            const submitBtn = document.querySelector('.btn-primary');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Creating Account...';
            submitBtn.disabled = true;

            try {
                // Create Firebase Auth user
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                const user = userCredential.user;
                
                // Create admin record in database
                const adminData = {
                    email: email,
                    role: 'admin',
                    active: true,
                    permissions: {
                        analytics: true,
                        support: true,
                        users: true
                    },
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString(),
                    requestReason: reason || 'No reason provided'
                };
                
                await database.ref(`admins/${user.uid}`).set(adminData);
                
                // Show success and redirect to dashboard
                showSuccess('Account created successfully! Redirecting to dashboard...');
                
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 3000);
                
            } catch (error) {
                console.error('Signup error:', error);
                
                let errorMessage = 'Failed to create account. Please try again.';
                
                switch (error.code) {
                    case 'auth/email-already-in-use':
                        errorMessage = 'An account with this email already exists.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Please enter a valid email address.';
                        break;
                    case 'auth/weak-password':
                        errorMessage = 'Password is too weak. Please choose a stronger password.';
                        break;
                }
                
                showError(errorMessage);
            } finally {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        });

        function showError(message) {
            const existingError = document.querySelector('.error-message');
            if (existingError) existingError.remove();
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            errorDiv.style.cssText = `
                background: #ff4444;
                color: white;
                padding: 10px;
                border-radius: 4px;
                margin-top: 15px;
                font-size: 0.9rem;
                text-align: center;
            `;
            
            document.querySelector('.login-form').appendChild(errorDiv);
            
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.remove();
                }
            }, 5000);
        }

        function showSuccess(message) {
            const existingError = document.querySelector('.error-message');
            if (existingError) existingError.remove();
            
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            successDiv.style.cssText = `
                background: #00ff88;
                color: #000000;
                padding: 10px;
                border-radius: 4px;
                margin-top: 15px;
                font-size: 0.9rem;
                text-align: center;
                font-weight: 500;
            `;
            
            document.querySelector('.login-form').appendChild(successDiv);
        }
    </script>
</body>
</html>
